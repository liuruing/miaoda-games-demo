<!doctype html><!--å£°æ˜å½“å‰æ–‡æ¡£ä¸ºhtmlæ–‡æ¡£-->
<html lang="en"><!--è¯­è¨€ä¸ºè‹±è¯­-->
	<head><!--å¤´éƒ¨-->
		<meta charset="UTF-8"><!--å­—ç¬¦ç¼–ç ï¼šutf-8å›½é™…ç¼–ç   gb2312ä¸­æ–‡ç¼–ç -->
		<meta name="Keywords" content="å…³é”®è¯">
		<meta name="Description" content="æè¿°">
		<title>HTML5 canvaså°äººæ¨ç®±å­å°æ¸¸æˆ</title>
		<style>/*cssæ ·å¼è¡¨çš„è¡£æŸœ*/
		*{
			margin:0px;
			padding:0px;
		}
		body{
			overflow:hidden;
		}
		.game{
			width:560px;
			margin:50px auto;
		}
		
		@keyframes fadeIn {
		    from { opacity: 0; transform: scale(0.9); }
		    to { opacity: 1; transform: scale(1); }
		}

		@keyframes fadeOut {
		    from { opacity: 1; transform: scale(1); }
		    to { opacity: 0; transform: scale(0.9); }
		}

		.fade-out {
		    animation: fadeOut 0.5s ease-out forwards;
		}
		</style>
	</head>
	<body onkeydown="doKeyDown(event)"><!--èº«ä½“-->
		<!-- æ¨ç®±å­æ¸¸æˆå¼€å±å¹¿å‘Š -->
		<div id="splashAd" style="
		    position: fixed;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 100%;
		    background: linear-gradient(135deg, #3498DB 0%, #2980B9 50%, #1ABC9C 100%);
		    z-index: 9999;
		    display: flex;
		    flex-direction: column;
		    justify-content: center;
		    align-items: center;
		    color: white;
		    font-family: 'Microsoft YaHei', Arial, sans-serif;
		    animation: fadeIn 0.5s ease-in;
		">
		    <div style="text-align: center; max-width: 80%; padding: 20px;">
		        <div id="adContent">
		            <h1 style="font-size: 3em; margin-bottom: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.7); color: #F1C40F;">
		                ğŸ“¦ æ™ºèƒ½ç‰©æµæœåŠ¡ ğŸ“¦
		            </h1>
		            <p style="font-size: 1.4em; margin-bottom: 30px; line-height: 1.6; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
		                åƒæ¨ç®±å­ä¸€æ ·ç²¾å‡†é«˜æ•ˆï¼Œä¸ºæ‚¨æä¾›ä¸“ä¸šç‰©æµè§£å†³æ–¹æ¡ˆï¼<br>
		                æ–°ç”¨æˆ·æ³¨å†Œç«‹äº«é¦–å•å…è´¹ï¼Œå¤§ä»¶ç‰©å“ä¸“ä¸šæ¬è¿ï¼
		            </p>
		            <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
		                <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; backdrop-filter: blur(10px); min-width: 150px;">
		                    <div style="font-size: 2em; margin-bottom: 10px;">ğŸšš</div>
		                    <h3>åŒåŸé…é€</h3>
		                    <p style="color: #F1C40F; font-weight: bold;">2å°æ—¶è¾¾</p>
		                </div>
		                <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; backdrop-filter: blur(10px); min-width: 150px;">
		                    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ </div>
		                    <h3>æ¬å®¶æœåŠ¡</h3>
		                    <p style="color: #F1C40F; font-weight: bold;">ä¸“ä¸šå›¢é˜Ÿ</p>
		                </div>
		                <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; backdrop-filter: blur(10px); min-width: 150px;">
		                    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“‹</div>
		                    <h3>ä»“å‚¨ç®¡ç†</h3>
		                    <p style="color: #F1C40F; font-weight: bold;">æ™ºèƒ½åˆ†æ‹£</p>
		                </div>
		            </div>
		            <div style="background: rgba(241,196,15,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
		                <p style="font-size: 1.1em; font-weight: bold;">ğŸ¯ æ¨ç®±é«˜æ‰‹ä¸“äº«ï¼šé¢„çº¦æ¬å®¶æœåŠ¡äº«å—8æŠ˜ä¼˜æƒ ï¼Œå…è´¹æä¾›æ‰“åŒ…ææ–™ï¼</p>
		            </div>
		        </div>
		        
		        <div style="margin-top: 30px;">
		            <button id="skipAd" style="
		                background: #E67E22;
		                color: white;
		                border: none;
		                padding: 15px 40px;
		                font-size: 1.2em;
		                border-radius: 30px;
		                cursor: pointer;
		                transition: all 0.3s ease;
		                box-shadow: 0 6px 20px rgba(230,126,34,0.4);
		                font-weight: bold;
		            " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(230,126,34,0.6)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 6px 20px rgba(230,126,34,0.4)'">
		                è·³è¿‡å¹¿å‘Šï¼Œå¼€å§‹æ¨ç®± (<span id="countdown">5</span>s)
		            </button>
		        </div>
		    </div>
		</div>

		<div class="game" id="gameContent" style="display: none;">
			<canvas id="canvas" width="560" height="560"></canvas>
			<div id="msg"></div>
			<input type="button" value="ä¸Šä¸€å…³" onClick="NextLevel(-1)">
			<input type="button" value="ä¸‹ä¸€å…³" onClick="NextLevel(1)">
			<input type="button" value="é‡ç©æœ¬å…³" onClick="NextLevel(0)">
			<input type="button" value="æ¸¸æˆè¯´æ˜" onClick="showHelp()">
		</div>
	
	<script>
		// å¼€å±å¹¿å‘Šé€»è¾‘
		(function() {
		    let countdown = 5;
		    const countdownElement = document.getElementById('countdown');
		    const skipButton = document.getElementById('skipAd');
		    const splashAd = document.getElementById('splashAd');
		    const gameContent = document.getElementById('gameContent');
		    
		    // å€’è®¡æ—¶
		    const timer = setInterval(() => {
		        countdown--;
		        countdownElement.textContent = countdown;
		        
		        if (countdown <= 0) {
		            clearInterval(timer);
		            skipButton.innerHTML = 'å¼€å§‹æ¨ç®±å­ ğŸ“¦';
		            skipButton.style.background = '#27AE60';
		        }
		    }, 1000);
		    
		    // è·³è¿‡å¹¿å‘Š
		    skipButton.addEventListener('click', () => {
		        if (countdown <= 0 || confirm('ç¡®å®šè¦è·³è¿‡å¹¿å‘Šå—ï¼Ÿ')) {
		            splashAd.classList.add('fade-out');
		            setTimeout(() => {
		                splashAd.style.display = 'none';
		                gameContent.style.display = 'block';
		            }, 500);
		        }
		    });
		    
		    // è‡ªåŠ¨å…³é—­
		    setTimeout(() => {
		        if (splashAd.style.display !== 'none') {
		            skipButton.click();
		        }
		    }, 8000);
		})();
	</script>
	<script src="js/mapdata100.js"></script>
	<script>
		var can = document.getElementById("canvas");
		var msg = document.getElementById("msg");
		var cxt = can.getContext("2d");
		var w = 35,h = 35;
		var curMap;//å½“å‰çš„åœ°å›¾
		var curLevel;//å½“å‰ç­‰çº§çš„åœ°å›¾
		var curMan;//åˆå§‹åŒ–å°äºº
		var iCurlevel = 0;//å…³å¡æ•°
		var moveTimes = 0;//ç§»åŠ¨äº†å¤šå°‘æ¬¡
		//é¢„åŠ è½½æ‰€æœ‰å›¾ç‰‡
		var oImgs = {
			"block" : "images/block.gif",
			"wall" : "images/wall.png",
			"box" : "images/box.png",
			"ball" : "images/ball.png",
			"up" : "images/up.png",
			"down" : "images/down.png",
			"left" : "images/left.png",
			"right" : "images/right.png",
		}
		function imgPreload(srcs,callback){
			var count = 0,imgNum = 0,images = {};

			for(src in srcs){
				imgNum++;
			}
			for(src in srcs ){
				images[src] = new Image();
				images[src].onload = function(){
					//åˆ¤æ–­æ˜¯å¦æ‰€æœ‰çš„å›¾ç‰‡éƒ½é¢„åŠ è½½å®Œæˆ
					if (++count >= imgNum)
					{
						callback(images);
					}
				}
				images[src].src = srcs[src];
			}
		}
		var block,wall,box,ball,up,down,left,right;
		imgPreload(oImgs,function(images){
			//console.log(images.block);
			block = images.block;
			wall = images.wall;
			box = images.box;
			ball = images.ball;
			up = images.up;
			down = images.down;
			left = images.left;
			right = images.right;
			init();
		});
		//åˆå§‹åŒ–æ¸¸æˆ
		function init(){
			//InitMap();
			//DrawMap(levels[0]);
			initLevel();//åˆå§‹åŒ–å¯¹åº”ç­‰çº§çš„æ¸¸æˆ
			showMoveInfo();//åˆå§‹åŒ–å¯¹åº”ç­‰çº§çš„æ¸¸æˆæ•°æ®
		}
		//ç»˜åˆ¶åœ°æ¿
		function InitMap(){
			for (var i=0;i<16 ;i++ )
			{
				for (var j=0;j<16 ;j++ )
				{
					cxt.drawImage(block,w*j,h*i,w,h);
				}
			}
		}
		//å°äººä½ç½®åæ ‡
		function Point(x,y){
			this.x = x;
			this.y = y;
		}
		var perPosition = new Point(5,5);//å°äººçš„åˆå§‹æ ‡å€¼
		//ç»˜åˆ¶æ¯ä¸ªæ¸¸æˆå…³å¡åœ°å›¾
		function DrawMap(level){
			for (var i=0;i<level.length ;i++ )
			{
				for (var j=0;j<level[i].length ;j++ )
				{
					var pic = block;//åˆå§‹å›¾ç‰‡
					switch (level[i][j])
					{
					case 1://ç»˜åˆ¶å¢™å£
						pic = wall;
						break;
					case 2://ç»˜åˆ¶é™·è¿›
						pic = ball;
						break;
					case 3://ç»˜åˆ¶ç®±å­
						pic = box;
						break;
					case 4://ç»˜åˆ¶å°äºº
						pic = curMan;//å°äººæœ‰å››ä¸ªæ–¹å‘ å…·ä½“æ˜¾ç¤ºå“ªä¸ªå›¾ç‰‡éœ€è¦å’Œä¸Šä¸‹å·¦å³æ–¹ä½å€¼å…³è”
						//è·å–å°äººçš„åæ ‡ä½ç½®
						perPosition.x = i;
						perPosition.y = j;
						break;
					case 5://ç»˜åˆ¶ç®±å­åŠé™·è¿›ä½ç½®
						pic = box;
						break;
					}
					//æ¯ä¸ªå›¾ç‰‡ä¸ä¸€æ ·å®½ éœ€è¦åœ¨å¯¹åº”åœ°æ¿çš„ä¸­å¿ƒç»˜åˆ¶åœ°å›¾
					cxt.drawImage(pic,w*j-(pic.width-w)/2,h*i-(pic.height-h),pic.width,pic.height)
				}
			}
		}
		//åˆå§‹åŒ–æ¸¸æˆç­‰çº§
		function initLevel(){
			curMap = copyArray(levels[iCurlevel]);//å½“å‰ç§»åŠ¨è¿‡çš„æ¸¸æˆåœ°å›¾
			curLevel = levels[iCurlevel];//å½“å‰ç­‰çº§çš„åˆå§‹åœ°å›¾
			curMan = down;//åˆå§‹åŒ–å°äºº
			InitMap();//åˆå§‹åŒ–åœ°æ¿
			DrawMap(curMap);//ç»˜åˆ¶å‡ºå½“å‰ç­‰çº§çš„åœ°å›¾
		}
		//ä¸‹ä¸€å…³
		function NextLevel(i){
			//iCurlevelå½“å‰çš„åœ°å›¾å…³æ•°
			iCurlevel = iCurlevel + i;
			if (iCurlevel<0)
			{
				iCurlevel = 0;
				return;
			}
			var len = levels.length;
			if (iCurlevel > len-1)
			{
				iCurlevel = len-1;
			}
			initLevel();//åˆå§‹å½“å‰ç­‰çº§å…³å¡
			moveTimes = 0;//æ¸¸æˆå…³å¡ç§»åŠ¨æ­¥æ•°æ¸…é›¶
			showMoveInfo();//åˆå§‹åŒ–å½“å‰å…³å¡æ•°æ®
		}
		//å°äººç§»åŠ¨
		function go(dir){
			var p1,p2;
			switch (dir)
			{
			case "up":
				curMan = up;
				//è·å–å°äººå‰é¢çš„ä¸¤ä¸ªåæ ‡ä½ç½®æ¥è¿›è¡Œåˆ¤æ–­å°äººæ˜¯å¦èƒ½å¤Ÿç§»åŠ¨
				p1 = new Point(perPosition.x-1,perPosition.y);
				p2 = new Point(perPosition.x-2,perPosition.y);
				break;
			case "down":
				curMan = down;
				p1 = new Point(perPosition.x+1,perPosition.y);
				p2 = new Point(perPosition.x+2,perPosition.y);
				break;
			case "left":
				curMan = left;
				p1 = new Point(perPosition.x,perPosition.y-1);
				p2 = new Point(perPosition.x,perPosition.y-2);
				break;
			case "right":
				curMan = right;
				p1 = new Point(perPosition.x,perPosition.y+1);
				p2 = new Point(perPosition.x,perPosition.y+2);
				break;
			}
			//è‹¥æœå°äººèƒ½å¤Ÿç§»åŠ¨çš„è¯ï¼Œæ›´æ–°æ¸¸æˆæ•°æ®ï¼Œå¹¶é‡ç»˜åœ°å›¾
			if (Trygo(p1,p2))
			{
				moveTimes ++;
				showMoveInfo();
			}
			//é‡ç»˜åœ°æ¿
			InitMap();
			//é‡ç»˜å½“å‰æ›´æ–°äº†æ•°æ®çš„åœ°å›¾
			DrawMap(curMap);
			//è‹¥æœç§»åŠ¨å®Œæˆäº†è¿›å…¥ä¸‹ä¸€å…³
			if (checkFinish())
			{
				alert("æ­å–œè¿‡å…³ï¼ï¼");
				NextLevel(1);
			}
		}
		//åˆ¤æ–­æ˜¯å¦æ¨æˆåŠŸ
		function checkFinish(){
			for (var i=0;i<curMap.length ;i++ )
			{
				for (var j=0;j<curMap[i].length ;j++ )
				{
					//å½“å‰ç§»åŠ¨è¿‡çš„åœ°å›¾å’Œåˆå§‹åœ°å›¾è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥æœåˆå§‹åœ°å›¾ä¸Šçš„é™·è¿›å‚æ•°åœ¨ç§»åŠ¨ä¹‹åä¸æ˜¯ç®±å­çš„è¯å°±æŒ‡ä»£æ²¡æ¨æˆåŠŸ
					if (curLevel[i][j] == 2 && curMap[i][j] != 3 || curLevel[i][j] == 5 && curMap[i][j] != 3)
					{
						return false;
					}
				}
			}
			return true;
		}
		//åˆ¤æ–­å°äººæ˜¯å¦èƒ½å¤Ÿç§»åŠ¨
		function Trygo(p1,p2){
			if(p1.x<0) return false;//è‹¥æœè¶…å‡ºåœ°å›¾çš„ä¸Šè¾¹ï¼Œä¸é€šè¿‡
			if(p1.y<0) return false;//è‹¥æœè¶…å‡ºåœ°å›¾çš„å·¦è¾¹ï¼Œä¸é€šè¿‡
			if(p1.x>curMap.length) return false;//è‹¥æœè¶…å‡ºåœ°å›¾çš„ä¸‹è¾¹ï¼Œä¸é€šè¿‡
			if(p1.y>curMap[0].length) return false;//è‹¥æœè¶…å‡ºåœ°å›¾çš„å³è¾¹ï¼Œä¸é€šè¿‡
			if(curMap[p1.x][p1.y]==1) return false;//è‹¥æœå‰é¢æ˜¯å¢™ï¼Œä¸é€šè¿‡
			if (curMap[p1.x][p1.y]==3 || curMap[p1.x][p1.y]==5)
			{//è‹¥æœå°äººå‰é¢æ˜¯ç®±å­é‚£å°±è¿˜éœ€è¦åˆ¤æ–­ç®±å­å‰é¢æœ‰æ²¡æœ‰éšœç¢ç‰©(ç®±å­/å¢™)
				if (curMap[p2.x][p2.y]==1 || curMap[p2.x][p2.y]==3)
				{
					return false;
				}
				//è‹¥æœåˆ¤æ–­ä¸æˆåŠŸå°äººå‰é¢çš„ç®±å­å‰è¿›ä¸€æ­¥
				curMap[p2.x][p2.y] = 3;//æ›´æ”¹åœ°å›¾å¯¹åº”åæ ‡ç‚¹çš„å€¼
				//console.log(curMap[p2.x][p2.y]);
			}
			//è‹¥æœéƒ½æ²¡åˆ¤æ–­æˆåŠŸå°äººå‰è¿›ä¸€æ­¥
			curMap[p1.x][p1.y] = 4;//æ›´æ”¹åœ°å›¾å¯¹åº”åæ ‡ç‚¹çš„å€¼
			//è‹¥æœå°äººå‰è¿›äº†ä¸€æ­¥ï¼Œå°äººåŸæ¥çš„ä½ç½®å¦‚ä½•æ˜¾ç¤º
			var v = curLevel[perPosition.x][perPosition.y];
			if (v!=2)//è‹¥æœåˆšå¼€å§‹å°äººä½ç½®ä¸æ˜¯é™·è¿›çš„è¯
			{
				if (v==5)//å¯èƒ½æ˜¯5 æ—¢æœ‰ç®±å­åˆé™·è¿›
				{
					v=2;//è‹¥æœå°äººæœ¬èº«å°±åœ¨é™·è¿›é‡Œé¢çš„è¯ç§»å¼€ä¹‹åè¿˜æ˜¯æ˜¾ç¤ºé™·è¿›
				}else{
					v=0;//å°äººç§»å¼€ä¹‹åä¹‹å‰å°äººçš„ä½ç½®æ”¹ä¸ºåœ°æ¿
				}
			}
			//é‡ç½®å°äººä½ç½®çš„åœ°å›¾å‚æ•°
			curMap[perPosition.x][perPosition.y] = v;
			//è‹¥æœåˆ¤æ–­å°äººå‰è¿›äº†ä¸€æ­¥ï¼Œæ›´æ–°åæ ‡å€¼
			perPosition = p1;
			//è‹¥æœå°åŠ¨äº† è¿”å›true æŒ‡ä»£èƒ½å¤Ÿç§»åŠ¨å°äºº
			return true;
		}
		//åˆ¤æ–­æ˜¯å¦æ¨æˆåŠŸ
		//ä¸é”®ç›˜ä¸Šçš„ä¸Šä¸‹å·¦å³é”®å…³è”
		function doKeyDown(event){
			switch (event.keyCode)
			{
			case 37://å·¦é”®å¤´
				go("left");
				break;
			case 38://ä¸Šé”®å¤´
				go("up");
				break;
			case 39://å³ç®­å¤´
				go("right");
				break;
			case 40://ä¸‹ç®­å¤´
				go("down");
				break;
			}

		}
		//å®Œå–„å…³å¡æ•°æ®åŠæ¸¸æˆè¯´æ˜
		function showMoveInfo(){
			msg.innerHTML = "ç¬¬" + (iCurlevel+1) +"å…³ ç§»åŠ¨æ¬¡æ•°: "+ moveTimes;
		}
		//æ¸¸æˆè¯´æ˜
		var showhelp = false;
		function showHelp(){
			showhelp = !showhelp;
			if (showhelp)
			{
				msg.innerHTML = "ç”¨é”®ç›˜ä¸Šçš„ä¸Šã€ä¸‹ã€å·¦ã€å³é”®ç§»åŠ¨å°äººï¼ŒæŠŠç®±å­å…¨éƒ¨æ¨åˆ°å°çƒçš„ä½ç½®å³å¯è¿‡å…³ã€‚ç®±å­åªå¯å‘å‰æ¨ï¼Œä¸èƒ½å¾€åæ‹‰ï¼Œå¹¶ä¸”å°äººä¸€æ¬¡åªèƒ½æ¨åŠ¨ä¸€ä¸ªç®±å­ã€‚";
			}else{
				showMoveInfo();
			}
		}

		//å…‹éš†äºŒç»´æ•°ç»„
		function copyArray(arr){
			var b=[];//æ¯æ¬¡ç§»åŠ¨æ›´æ–°åœ°å›¾æ•°æ®éƒ½å…ˆæ¸…ç©ºå†æ·»åŠ æ–°çš„åœ°å›¾
			for (var i=0;i<arr.length ;i++ )
			{
				b[i] = arr[i].concat();//é“¾æ¥ä¸¤ä¸ªæ•°ç»„
			}
			return b;
		}
	</script>
</body>	
</html>
